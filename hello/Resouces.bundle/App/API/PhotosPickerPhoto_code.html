
<!doctype html>
<html>
    <head>
        <meta charset='UTF-8'>
        <meta name="viewport" content=" width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
        <link type="text/css" rel="stylesheet" href="../static/github.min.css" />
        <script src="../static/marked.min.js"></script>
        <script src="../static/highlight.min.js"></script>
        <style>body{font-size: 16px;line-height: 21px;-webkit-text-size-adjust: none;}</style>
    </head>
    <body>
        <div id="content"></div>
        <script>
let mdtext = `
\`\`\`swift
// matching 可以选择相册照片类型。常用的值：.images .videos  .any(of: [.images, .videos])  .any(of: [.images, .not(.livePhotos)])

import SwiftUI
import PhotosUI

struct api_PhotosPicker: View {
    var body: some View {
        
        ScrollView {
            VStack(alignment: .center) {
                
                Text("本示例适用于iOS 16.0+，用到了PhotosPicker()")
                    .font(.caption)
                    .foregroundColor(.gray)
                    .frame(height: 200)
                
                if #available(iOS 16.0, *) {
                    choicePhoto(selectedNum: 3)
                }
            }
            .navigationTitle("PhotosPicker")
            .modifier(navBarViewCodeAndDocs(pageType: "API",pageID: "PhotosPickerPhoto"))
        }
    }
}

// 选择多张图片
@available (iOS 16.0, *)
struct choicePhoto: View {
    // 选择的照片数量，最多只能选9
    @State var selectedNum: Int = 9
    
    @State private var selectedItems: [PhotosPickerItem] = []
    @State private var selectedImageData: [Data] = []
    
    var body: some View {
        
        // 将选择的照片显示出来
        if !selectedImageData.isEmpty {
            ScrollView(.horizontal, showsIndicators: false) {
                HStack(alignment: .center) {
                    ForEach(selectedImageData, id: \.self) { photoData in
                        if let img = UIImage(data: photoData) {
                            Image(uiImage: img)
                                .resizable()
                                .scaledToFit()
                                .frame(width: 150, height: 100)
                        }
                    }
                }
                .frame(height: 150)
                .padding()
            }
        }
        
        PhotosPicker(
            selection: $selectedItems,
            maxSelectionCount: $selectedNum.wrappedValue,
            matching: .images,
            photoLibrary: .shared()
        ) {
            Label("选择照片", systemImage: "photo")
        }
        .tint(.purple)
        .controlSize(.large)
        .buttonStyle(.borderedProminent)
        .onChange(of: selectedItems) { newItems in
            if !newItems.isEmpty {
                selectedImageData = []
            }
            for item in newItems {
                Task {
                    if let data = try? await item.loadTransferable(type: Data.self) {
                        selectedImageData.append(data)
                    }
                }
            }
        }
    }
}

struct api_PhotosPicker_Previews: PreviewProvider {
    static var previews: some View {
        api_PhotosPicker()
    }
}

\`\`\`
`
            hljs.highlightAll();
            document.getElementById('content').innerHTML = marked.parse(mdtext);
        </script>
    </body>
</html>
